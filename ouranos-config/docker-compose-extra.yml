version: '3.4'

x-logging: &default-logging
  driver: "json-file"
  options:
    max-size: "50m"
    max-file: "10"

services:
  proxy:
    volumes:
# This raven bypass Twitcher is for debugging only, should not be enabled
# permanently in prod.  Keep here as sample code and documentation how it can
# be done.
#    - ../../birdhouse-deploy-ouranos/ouranos-config/proxy/public-raven-bypass-twitcher.conf:/etc/nginx/conf.extra-service.d/raven/public-raven-bypass-twitcher.conf:ro
    - ../../birdhouse-deploy-ouranos/ouranos-config/proxy/cruesdeca-redirect.conf:/etc/nginx/conf.extra-service.d/redirect/cruesdeca-redirect.conf:ro
    - ${DATA_PERSIST_ROOT}/homepage:${DATA_PERSIST_ROOT}/homepage:ro
    - ../../birdhouse-deploy-ouranos/ouranos-config/proxy/catalog.conf:/etc/nginx/conf.extra-service.d/catalog/catalog.conf:ro
    - ${DATA_PERSIST_ROOT}/catalog:${DATA_PERSIST_ROOT}/catalog:ro
    - ../../birdhouse-deploy-ouranos/ouranos-config/proxy/ogc-geoserver.conf:/etc/nginx/conf.extra-service.d/ogc/ogc-geoserver.conf:ro

  magpie:
    volumes:
      - ../../birdhouse-deploy-ouranos/ouranos-config/magpie/ouranos-permissions.yml:${MAGPIE_PERMISSIONS_CONFIG_PATH}/ouranos-permissions.yml:ro

  jupyterhub:
    volumes:
    # So that in jupyterhub_config.py, we can do
    #     inpact_share_on_host = '/data/projects/INPACT-share-jupyter'
    #     if not os.path.exists(inpact_share_on_host):
    #         os.makedirs(inpact_share_on_host, mode=0o755, exist_ok=True)
    #         subprocess.call(['chown',
    #             f\"{os.environ['USER_WORKSPACE_UID']}:{os.environ['USER_WORKSPACE_GID']}\",
    #             inpact_share_on_host])
    - ${DATA_PERSIST_ROOT}/projects:${DATA_PERSIST_ROOT}/projects:rw
